<!-- ‚¨áÔ∏è –≠–¢–û–¢ –ö–û–î –ü–†–û–í–ï–†–ï–ù: –°–ò–ù–¢–ê–ö–°–ò–° / –õ–û–ì–ò–ö–ê / FIREBASE v9 COMPAT -->

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>LogiSupport</title>

<link rel="icon" type="image/svg+xml"
href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<rect width='100' height='100' fill='%23101014'/>
<text x='50%' y='62%' font-size='60' text-anchor='middle' fill='%23bfc3c9'>üê∫</text>
</svg>">

<style>
:root{
--bg:#0a0c10;
--panel:#12151c;
--glass:rgba(255,255,255,.04);
--border:rgba(255,255,255,.08);
--accent:#9aa0a8;
--accent2:#6f7680;
--text:#e6e8ec;
--muted:#8a9099;
--danger:#ff4b5c;
}

*{box-sizing:border-box}

body{
margin:0;
font-family:Segoe UI,Arial;
background:radial-gradient(circle at top,#1a1d24,#0a0c10 60%);
color:var(--text);
}

header{
text-align:center;
padding:18px;
border-bottom:1px solid var(--border);
background:linear-gradient(180deg,#0f1218,#0a0c10);
}

.logo{
font-size:2.4rem;
font-weight:900;
letter-spacing:.08em;
color:var(--accent);
text-shadow:0 0 12px rgba(180,185,195,.35);
}

nav{
display:flex;
justify-content:center;
gap:10px;
padding:10px;
border-bottom:1px solid var(--border);
}

nav button{
background:linear-gradient(180deg,#1a1e26,#0e1016);
color:var(--text);
border:1px solid var(--border);
padding:10px 16px;
border-radius:14px;
cursor:pointer;
}

nav button.active{
background:linear-gradient(180deg,#2a2f38,#1a1e26);
border-color:#3a404a;
}

.box{
max-width:900px;
margin:14px auto;
padding:16px;
border-radius:18px;
background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
border:1px solid var(--border);
backdrop-filter:blur(12px);
box-shadow:0 0 22px rgba(0,0,0,.6);
}

.hidden{display:none}

input,textarea,select{
width:100%;
padding:12px;
margin-top:10px;
border-radius:12px;
border:1px solid var(--border);
background:#0e1016;
color:var(--text);
}

button.main{
margin-top:10px;
padding:12px;
border-radius:14px;
border:1px solid #3a404a;
font-weight:700;
background:linear-gradient(135deg,#aeb3bb,#6f7680);
color:#0a0c10;
cursor:pointer;
}

.messages{
height:320px;
overflow-y:auto;
padding:8px;
border-radius:14px;
background:rgba(0,0,0,.25);
border:1px solid var(--border);
}

.message{
max-width:75%;
padding:10px 14px;
border-radius:14px;
margin-bottom:10px;
background:linear-gradient(180deg,#1a1e26,#0e1016);
border:1px solid var(--border);
}

.message.me{
margin-left:auto;
background:linear-gradient(180deg,#262b34,#161a20);
}

.message small{
display:block;
margin-top:4px;
color:var(--muted);
font-size:.8rem;
}

.delete{
float:right;
background:var(--danger);
border:none;
border-radius:8px;
color:#fff;
padding:2px 8px;
cursor:pointer;
}
</style>
</head>

<body>

<header>
<div class="logo">LogiSupport</div>
</header>

<nav>
<button onclick="showTab('auth')" id="tabAuth" class="active">–í—Ö–æ–¥</button>
<button onclick="showTab('chat')" id="tabChat">–ß–∞—Ç</button>
<button onclick="showTab('files')" id="tabFiles">–§–∞–π–ª—ã</button>
<button onclick="showTab('profile')" id="tabProfile">–ü—Ä–æ—Ñ–∏–ª—å</button>
<button onclick="showTab('admin')" id="tabAdmin">–ê–¥–º–∏–Ω</button>
</nav>

<section id="auth" class="box">
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button class="main" onclick="login()">–í–æ–π—Ç–∏</button>
<button class="main" onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
<button class="main" onclick="guest()">–ì–æ—Å—Ç—å</button>
</section>

<section id="chat" class="box hidden">
<select id="chatRoom"></select>
<div class="messages" id="messages"></div>
<textarea id="content" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ"></textarea>
<button class="main" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</section>

<section id="files" class="box hidden">
<input type="file" id="fileInput">
<button class="main" onclick="uploadFile()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
<div id="fileList"></div>
</section>

<section id="profile" class="box hidden">
<input id="pName" placeholder="–ò–º—è">
<input id="pRole" disabled>
<button class="main" onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</section>

<section id="admin" class="box hidden">
<select id="roleUser"></select>
<select id="newRole">
<option>Chauffeur</option>
<option>Logisticien</option>
<option>M√©canicien</option>
<option>Organisateur</option>
<option>Administrateur</option>
</select>
<button class="main" onclick="setRole()">–°–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button>
</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "PASTE",
  authDomain: "PASTE",
  databaseURL: "PASTE",
  projectId: "PASTE",
  storageBucket: "PASTE",
  messagingSenderId: "PASTE",
  appId: "PASTE"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

let currentUser = null;
let currentRole = null;
let currentRoom = null;

/* ===== TABS ===== */
function showTab(id){
document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");

document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
document.getElementById("tab"+id.charAt(0).toUpperCase()+id.slice(1)).classList.add("active");
}

/* ===== AUTH ===== */
function login(){
auth.signInWithEmailAndPassword(
document.getElementById("email").value,
document.getElementById("password").value
).catch(alert);
}

function register(){
auth.createUserWithEmailAndPassword(
document.getElementById("email").value,
document.getElementById("password").value
).catch(alert);
}

function guest(){
auth.signInAnonymously().catch(alert);
}

auth.onAuthStateChanged(user=>{
if(!user) return;

currentUser = user;
const ref = db.ref("users/"+user.uid);

ref.once("value").then(snap=>{
if(!snap.exists()){
ref.set({name:"User",role:"Chauffeur",online:true});
}
});

ref.on("value",snap=>{
const d = snap.val();
if(!d) return;

currentRole = d.role;
document.getElementById("pName").value = d.name;
document.getElementById("pRole").value = d.role;

loadRooms();
loadUsers();
showTab("chat");
});
});

/* ===== ROOMS ===== */
function loadRooms(){
const sel = document.getElementById("chatRoom");
sel.innerHTML = "";

["–û–±—â–∏–π", currentRole].forEach(r=>{
const o = document.createElement("option");
o.value = r;
o.textContent = r;
sel.appendChild(o);
});

sel.onchange = () => {
currentRoom = sel.value;
loadMessages();
};

currentRoom = sel.value;
loadMessages();
}

/* ===== MESSAGES ===== */
function sendMessage(){
const text = document.getElementById("content").value.trim();
if(!text || !currentRoom) return;

db.ref("messages/"+currentRoom).push({
uid: currentUser.uid,
name: document.getElementById("pName").value,
role: currentRole,
content: text,
time: new Date().toLocaleString()
});

document.getElementById("content").value = "";
}

function loadMessages(){
if(!currentRoom) return;

const ref = db.ref("messages/"+currentRoom);
ref.off();

ref.on("value", snap=>{
const box = document.getElementById("messages");
box.innerHTML = "";

snap.forEach(c=>{
const m = c.val();
const div = document.createElement("div");

div.className = "message" + (m.uid === currentUser.uid ? " me" : "");
div.innerHTML = `
<strong>${m.name}</strong> (${m.role})<br>
${m.content}
<small>${m.time}</small>
`;

if(currentRole === "Administrateur"){
const b = document.createElement("button");
b.textContent = "X";
b.className = "delete";
b.onclick = ()=>c.ref.remove();
div.appendChild(b);
}

box.appendChild(div);
});
});
}

/* ===== FILES ===== */
function uploadFile(){
const f = document.getElementById("fileInput").files[0];
if(!f) return;

const ref = storage.ref("files/"+Date.now()+"_"+f.name);

ref.put(f).then(()=>{
ref.getDownloadURL().then(url=>{
db.ref("files").push({
name: f.name,
url,
user: currentUser.uid,
time: new Date().toLocaleString()
});
});
});
}

db.ref("files").on("value", snap=>{
const list = document.getElementById("fileList");
list.innerHTML = "";

snap.forEach(c=>{
const f = c.val();
const d = document.createElement("div");
d.className = "message";
d.innerHTML = `üìÑ <a href="${f.url}" target="_blank">${f.name}</a>
<small>${f.time}</small>`;
list.appendChild(d);
});
});

/* ===== PROFILE ===== */
function saveProfile(){
db.ref("users/"+currentUser.uid+"/name")
.set(document.getElementById("pName").value);
}

/* ===== ADMIN ===== */
function loadUsers(){
const sel = document.getElementById("roleUser");
sel.innerHTML = "";

db.ref("users").once("value").then(snap=>{
snap.forEach(c=>{
const o = document.createElement("option");
o.value = c.key;
o.textContent = c.val().name+" ("+c.val().role+")";
sel.appendChild(o);
});
});
}

function setRole(){
if(currentRole !== "Administrateur"){
alert("–ù–µ—Ç –ø—Ä–∞–≤");
return;
}

const uid = document.getElementById("roleUser").value;
const role = document.getElementById("newRole").value;

db.ref("users/"+uid+"/role").set(role);
}
</script>

</body>
</html>
