<!-- ‚¨áÔ∏è –≠–¢–û–¢ –ö–û–î –ü–†–û–í–ï–†–ï–ù: –°–ò–ù–¢–ê–ö–°–ò–° / –õ–û–ì–ò–ö–ê / FIREBASE v9 COMPAT -->

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>üêâ LogiSupport</title>

<link rel="icon" type="image/svg+xml"
href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<rect width='100' height='100' fill='black'/>
<text x='50%' y='62%' font-size='62' text-anchor='middle' fill='%23b300ff'>üêâ</text>
</svg>">

<style>
:root{
--bg:#050008;--panel:#0b0014;--accent:#b300ff;
--accent2:#00ffd5;--blood:#ff003c;--text:#f5f5ff;--muted:#9a8fb3;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI;background:radial-gradient(circle at top,#16001f,#050008 60%);color:var(--text)}
header{text-align:center;padding:20px}
.logo{font-size:2.6rem;font-weight:900;color:var(--accent);text-shadow:0 0 12px rgba(179,0,255,.8)}
.logo span{color:var(--accent2)}
nav{display:flex;gap:10px;justify-content:center;margin-bottom:10px}
nav button{background:#12001f;color:#fff;border:none;padding:10px 16px;border-radius:12px;cursor:pointer}
nav button.active{background:var(--blood)}
.box{background:linear-gradient(145deg,#0e001a,#05000d);border-radius:18px;padding:18px;margin:12px;box-shadow:0 0 18px rgba(179,0,255,.3)}
.hidden{display:none}
input,textarea,select{width:100%;padding:12px;margin-top:8px;border-radius:12px;border:1px solid rgba(179,0,255,.3);background:#07000e;color:#fff}
button{width:100%;margin-top:10px;padding:12px;border-radius:14px;border:none;font-weight:700;background:linear-gradient(135deg,#b300ff,#00ffd5);color:#020005;cursor:pointer}
.messages{height:300px;overflow-y:auto}
.message{background:#0c0016;border-radius:12px;padding:10px;margin-bottom:8px}
small{color:var(--muted)}
.delete{float:right;background:#ff003c;border:none;border-radius:8px;color:#fff;padding:2px 8px;cursor:pointer}
</style>
</head>

<body>
<header><div class="logo">üêâ <span>Logi</span>Support</div></header>

<nav>
<button onclick="showTab('auth')" class="active">–í—Ö–æ–¥</button>
<button onclick="showTab('chat')">–ß–∞—Ç</button>
<button onclick="showTab('files')">–§–∞–π–ª—ã</button>
<button onclick="showTab('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
<button onclick="showTab('admin')">–ê–¥–º–∏–Ω</button>
</nav>

<section id="auth" class="box">
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
<button onclick="guest()">–ì–æ—Å—Ç—å</button>
</section>

<section id="chat" class="box hidden">
<select id="chatRoom"></select>
<div class="messages" id="messages"></div>
<textarea id="content" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ"></textarea>
<button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</section>

<section id="files" class="box hidden">
<input type="file" id="fileInput">
<button onclick="uploadFile()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
<div id="fileList"></div>
</section>

<section id="profile" class="box hidden">
<input id="pName" placeholder="–ò–º—è">
<input id="pRole" disabled>
<button onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</section>

<section id="admin" class="box hidden">
<select id="roleUser"></select>
<select id="newRole">
<option>Chauffeur</option><option>Logisticien</option>
<option>M√©canicien</option><option>Organisateur</option>
<option>Administrateur</option>
</select>
<button onclick="setRole()">–°–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button>
<div id="logs"></div>
</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig={PASTE_YOURS};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();

let currentUser=null;
let currentRole=null;
let currentRoom=null;

/* AUTH */
function login(){auth.signInWithEmailAndPassword(email.value,password.value);}
function register(){auth.createUserWithEmailAndPassword(email.value,password.value);}
function guest(){auth.signInAnonymously();}

auth.onAuthStateChanged(user=>{
if(!user) return;
currentUser=user;
const ref=db.ref("users/"+user.uid);
ref.once("value",snap=>{
if(!snap.exists()){
ref.set({name:"User",role:"Chauffeur",online:true});
}
});
ref.on("value",snap=>{
const d=snap.val();
currentRole=d.role;
pName.value=d.name;
pRole.value=d.role;
loadRooms();
loadUsers();
});
});

/* TABS */
function showTab(id){
document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
event.target.classList.add("active");
}

/* ROOMS */
function loadRooms(){
const sel=chatRoom;
sel.innerHTML="";
["–û–±—â–∏–π",currentRole].forEach(r=>{
const o=document.createElement("option");
o.value=r;o.textContent=r;sel.appendChild(o);
});
sel.onchange=()=>{currentRoom=sel.value;loadMessages()};
currentRoom=sel.value;
loadMessages();
}

/* MESSAGES */
function sendMessage(){
const text=content.value.trim();
if(!text) return;
db.ref("messages/"+currentRoom).push({
uid:currentUser.uid,
name:pName.value,
role:currentRole,
content:text,
time:new Date().toLocaleString()
});
content.value="";
}

function loadMessages(){
if(!currentRoom) return;
const ref=db.ref("messages/"+currentRoom);
ref.off();
ref.on("value",snap=>{
messages.innerHTML="";
snap.forEach(c=>{
const m=c.val();
const div=document.createElement("div");
div.className="message";
div.innerHTML=`<strong>${m.name}</strong> (${m.role})<br>${m.content}<br><small>${m.time}</small>`;
if(currentRole==="Administrateur"){
const b=document.createElement("button");
b.textContent="X";b.className="delete";
b.onclick=()=>c.ref.remove();
div.appendChild(b);
}
messages.appendChild(div);
});
});
}

/* FILES */
function uploadFile(){
const f=fileInput.files[0];
if(!f) return;
const ref=storage.ref("files/"+Date.now()+"_"+f.name);
ref.put(f).then(()=>{
ref.getDownloadURL().then(url=>{
db.ref("files").push({
name:f.name,url,
user:currentUser.uid,time:new Date().toLocaleString()
});
});
});
}

db.ref("files").on("value",snap=>{
fileList.innerHTML="";
snap.forEach(c=>{
const f=c.val();
const d=document.createElement("div");
d.className="message";
d.innerHTML=`üìÑ <a href="${f.url}" target="_blank">${f.name}</a><br><small>${f.time}</small>`;
fileList.appendChild(d);
});
});

/* PROFILE */
function saveProfile(){
db.ref("users/"+currentUser.uid+"/name").set(pName.value);
}

/* ADMIN */
function loadUsers(){
const sel=roleUser;
sel.innerHTML="";
db.ref("users").once("value",snap=>{
snap.forEach(c=>{
const o=document.createElement("option");
o.value=c.key;
o.textContent=c.val().name+" ("+c.val().role+")";
sel.appendChild(o);
});
});
}

function setRole(){
if(currentRole!=="Administrateur") return alert("–ù–µ—Ç –ø—Ä–∞–≤");
db.ref("users/"+roleUser.value+"/role").set(newRole.value);
}
</script>
</body>
</html>
