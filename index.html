<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LogiConnect – Chat logistique partagé</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#0f2027; color:#fff; margin:0; }
    header { padding:40px; text-align:center; background:#203a43; }
    section { padding:40px; }
    .container { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    .box { background:rgba(255,255,255,0.08); padding:20px; border-radius:10px; }
    input, textarea, select, button { width:100%; margin-top:10px; padding:10px; border-radius:6px; border:none; }
    button { background:#4facfe; color:#000; cursor:pointer; }
    .messages { max-height:400px; overflow-y:auto; }
    .message { background:rgba(0,0,0,0.5); padding:10px; border-radius:8px; margin-bottom:10px; }
    img { max-width:100%; margin-top:8px; border-radius:6px; }
  </style>
</head>
<body>

<header>
  <h1>LogiConnect</h1>
  <p>Chat partagé entre métiers de la logistique</p>
</header>

<section>
  <div class="container">

    <div class="box">
      <h3>Envoyer un message</h3>
      <input id="name" placeholder="Nom" />
      <select id="role">
        <option value="Logisticien">Logisticien</option>
        <option value="Organisateur">Organisateur</option>
        <option value="Chauffeur">Chauffeur</option>
        <option value="Mecanicien">Mécanicien</option>
        <option value="Etudiant">Étudiant</option>
      </select>
      <textarea id="content" placeholder="Message..."></textarea>
      <button onclick="sendMessage()">Envoyer</button>
    </div>

    <div class="box">
      <h3>Messages (temps réel)</h3>
      <select id="view" onchange="renderMessages()">
        <option value="ALL">Tous</option>
        <option value="Logisticien">Logisticiens</option>
        <option value="Organisateur">Organisateurs</option>
        <option value="Chauffeur">Chauffeurs</option>
        <option value="Mecanicien">Mécaniciens</option>
        <option value="Etudiant">Étudiants</option>
      </select>
      <div class="messages" id="messages"></div>
    </div>

  </div>
</section>

<script>
  // ✅ Configuration Firebase (Realtime Database)
  const firebaseConfig = {
    apiKey: "AIzaSyBLbswX9MiSInVqNW12POJ5OmAYKgy2ERw",
    authDomain: "projet-56900.firebaseapp.com",
    databaseURL: "https://projet-56900-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "projet-56900",
    storageBucket: "projet-56900.appspot.com",
    messagingSenderId: "753669702381",
    appId: "1:753669702381:web:0ac180682fba00c68542e4"
  };

  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
  const messagesRef = database.ref('messages');

  let allMessages = [];

  function sendMessage() {
    const name = document.getElementById('name').value;
    const role = document.getElementById('role').value;
    const content = document.getElementById('content').value;

    if (!name || !content) return alert('Champs requis');

    messagesRef.push({
      name,
      role,
      content,
      timestamp: Date.now()
    });

    document.getElementById('content').value = '';
  }

  messagesRef.on('value', snapshot => {
    allMessages = [];
    snapshot.forEach(child => {
      allMessages.push(child.val());
    });
    renderMessages();
  });

  function renderMessages() {
    const view = document.getElementById('view').value;
    const container = document.getElementById('messages');
    container.innerHTML = '';

    allMessages
      .sort((a,b)=>a.timestamp-b.timestamp)
      .forEach(msg => {
        if (view !== 'ALL' && msg.role !== view) return;
        const div = document.createElement('div');
        div.className = 'message';
        div.innerHTML = `<strong>${msg.name}</strong> (${msg.role})<p>${msg.content}</p>`;
        container.appendChild(div);
      });
  }
</script>

</body>
</html>

