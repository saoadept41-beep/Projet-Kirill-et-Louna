<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>K-NET ‚Ä¢ Neural Gate</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#01020a;
  font-family:'Orbitron',sans-serif;
}

#nebulaCanvas{
  position:fixed;
  inset:0;
  z-index:-1;
  display:block;
}

#sphere{
  position:absolute;
  top:50%;
  left:50%;
  width:280px;
  height:280px;
  margin-left:-140px;
  margin-top:-140px;
  border-radius:50%;
  background: radial-gradient(circle at 50% 50%, rgba(122,162,255,0.5), rgba(0,0,0,0.0) 70%);
  box-shadow:0 0 80px rgba(122,162,255,0.5),0 0 160px rgba(122,162,255,0.3);
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  animation:pulse 3s infinite alternate;
}

#logo{
  font-size:3rem;
  font-weight:900;
  color:#7aa2ff;
  text-shadow:0 0 25px #7aa2ff,0 0 50px #7aa2ff;
  pointer-events:none;
  user-select:none;
}

@keyframes pulse{
  0%{transform:scale(0.95);}
  100%{transform:scale(1.05);}
}

/* AUTH */
#auth{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:1s;
  background:rgba(2,3,15,0.85);
}

#auth.show{
  opacity:1;
  pointer-events:auto;
}

.authBox{
  width:360px;
  padding:36px;
  border-radius:22px;
  background:rgba(8,12,35,0.95);
  border:1px solid rgba(122,162,255,0.35);
  box-shadow:0 0 60px rgba(0,0,0,0.8);
  display:flex;
  flex-direction:column;
  gap:14px;
}

input,select,button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid rgba(122,162,255,0.3);
  background:rgba(10,15,40,0.95);
  color:#fff;
  font-family:inherit;
}

button{
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,#7aa2ff,#9b7aff);
  border:none;
}

.tabs{
  display:flex;
  justify-content:space-around;
  margin-bottom:14px;
}

.tab{
  cursor:pointer;
  font-weight:700;
  padding:10px;
  border-radius:12px;
  transition:0.3s;
}

.tab.active{
  background:rgba(122,162,255,0.2);
}
#errorMsg{
  color:#ff6b6b;
  text-align:center;
}
</style>
</head>
<body>

<canvas id="nebulaCanvas"></canvas>

<div id="sphere">
  <div id="logo">K-NET</div>
</div>

<div id="auth">
  <div class="authBox">
    <div class="tabs">
      <div class="tab active" id="tabLogin">Login</div>
      <div class="tab" id="tabRegister">Register</div>
    </div>

    <div id="loginForm">
      <input id="loginEmail" placeholder="Email">
      <input id="loginPassword" type="password" placeholder="Password">
      <button id="loginBtn">Login</button>
    </div>

    <div id="registerForm" style="display:none;">
      <input id="regEmail" placeholder="Email">
      <input id="regPassword" type="password" placeholder="Password">
      <input id="regNick" placeholder="Nickname">
      <select id="regRole">
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
        <option value="Chauffeur">üöó Chauffeur</option>
        <option value="Logisticien">üì¶ Logisticien</option>
        <option value="M√©canicien">üõ† M√©canicien</option>
        <option value="Organisateur">üìã Organisateur</option>
      </select>
      <button id="registerBtn">Register</button>
    </div>

    <div id="errorMsg"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

/* ================= FIREBASE ================= */
const firebaseConfig={
  apiKey:"AIzaSyBLbswX9MiSInVqNW12POJ5OmAYKgy2ERw",
  authDomain:"projet-56900.firebaseapp.com",
  databaseURL:"https://projet-56900-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"projet-56900",
  storageBucket:"projet-56900.firebasestorage.app",
  messagingSenderId:"753669702381",
  appId:"1:753669702381:web:0ac180682fba00c68542e4",
  measurementId:"G-M9X20GDLQN"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);

/* ================= NEBULA PARTICLES ================= */
const canvas=document.getElementById('nebulaCanvas');
const ctx=canvas.getContext('2d');
function resize(){canvas.width=innerWidth; canvas.height=innerHeight;}
resize(); window.onresize=resize;

let particles=[];
for(let i=0;i<150;i++){
  particles.push({x:canvas.width/2 + (Math.random()-0.5)*120, y:canvas.height/2 + (Math.random()-0.5)*120, r:Math.random()*4+2, dx:(Math.random()-0.5)*0.2, dy:(Math.random()-0.5)*0.2, alpha:Math.random()*0.5+0.2});
}

function draw(){
  ctx.fillStyle='rgba(1,2,10,0.15)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x+=p.dx; p.y+=p.dy;
    if(p.x<canvas.width/2-150)p.dx=Math.abs(p.dx);
    if(p.x>canvas.width/2+150)p.dx=-Math.abs(p.dx);
    if(p.y<canvas.height/2-150)p.dy=Math.abs(p.dy);
    if(p.y>canvas.height/2+150)p.dy=-Math.abs(p.dy);
    let grad=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r);
    grad.addColorStop(0,'rgba(122,162,255,'+p.alpha+')');
    grad.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=grad;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(draw);
}
draw();

/* ================= CLICK TRANSITION ================= */
const sphere=document.getElementById('sphere');
const authDiv=document.getElementById('auth');
sphere.onclick=()=>{
  sphere.style.transition='transform 0.8s, opacity 0.8s';
  sphere.style.transform='scale(5)';
  sphere.style.opacity='0';
  setTimeout(()=>authDiv.classList.add('show'),800);
};

/* ================= TAB SWITCH ================= */
const tabLogin=document.getElementById('tabLogin');
const tabRegister=document.getElementById('tabRegister');
const loginForm=document.getElementById('loginForm');
const registerForm=document.getElementById('registerForm');
tabLogin.onclick=()=>{
  tabLogin.classList.add('active');
  tabRegister.classList.remove('active');
  loginForm.style.display='block';
  registerForm.style.display='none';
  errorMsg.textContent='';
};
tabRegister.onclick=()=>{
  tabRegister.classList.add('active');
  tabLogin.classList.remove('active');
  loginForm.style.display='none';
  registerForm.style.display='block';
  errorMsg.textContent='';
};

/* ================= REGISTRATION ================= */
const registerBtn=document.getElementById('registerBtn');
const loginBtn=document.getElementById('loginBtn');
const errorMsg=document.getElementById('errorMsg');

registerBtn.onclick=async ()=>{
  errorMsg.textContent='';
  const email=document.getElementById('regEmail').value;
  const password=document.getElementById('regPassword').value;
  const nick=document.getElementById('regNick').value;
  const role=document.getElementById('regRole').value;

  if(!email || !password || !nick || !role){
    errorMsg.textContent='–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!';
    return;
  }

  try{
    const cred=await createUserWithEmailAndPassword(auth,email,password);
    const usersSnap=await get(ref(db,'users'));
    let finalRole = !usersSnap.exists() ? 'Administrateur' : role;
    await set(ref(db,'users/'+cred.user.uid),{nick, role:finalRole, createdAt:Date.now()});
    location.href='system.html';
  }catch(err){
    if(err.code==='auth/email-already-in-use'){
      errorMsg.textContent='–≠—Ç–æ—Ç email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω! –í–æ–π–¥–∏—Ç–µ.';
    } else {
      errorMsg.textContent=err.message;
    }
  }
};

/* ================= LOGIN ================= */
loginBtn.onclick=async ()=>{
  errorMsg.textContent='';
  const email=document.getElementById('loginEmail').value;
  const password=document.getElementById('loginPassword').value;

  if(!email || !password){
    errorMsg.textContent='–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!';
    return;
  }

  try{
    await signInWithEmailAndPassword(auth,email,password);
    location.href='system.html';
  }catch(err){
    errorMsg.textContent='–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: '+err.message;
  }
};
</script>

</body>
</html>



