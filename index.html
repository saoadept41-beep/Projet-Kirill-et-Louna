<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>LogiSupport</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0f1115;
  --panel:#1a1d23;
  --border:#2a2f38;
  --text:#e6e8ec;
  --muted:#9aa0a8;
  --accent:#b0b5bc;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:16px;
  text-align:center;
  border-bottom:1px solid var(--border);
}

.logo{
  font-size:2rem;
  font-weight:700;
  color:var(--accent);
}

nav{
  display:flex;
  justify-content:center;
  gap:8px;
  padding:10px;
  border-bottom:1px solid var(--border);
}

nav button{
  background:var(--panel);
  color:var(--text);
  border:1px solid var(--border);
  padding:8px 14px;
  border-radius:10px;
  cursor:pointer;
}

nav button.active{
  background:#2a2f38;
}

.box{
  max-width:900px;
  margin:16px auto;
  padding:16px;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
}

.hidden{display:none}

input,textarea,select{
  width:100%;
  padding:10px;
  margin-top:10px;
  background:#0f1115;
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
}

button.main{
  margin-top:10px;
  padding:10px;
  width:100%;
  border-radius:10px;
  border:none;
  background:#b0b5bc;
  color:#000;
  font-weight:600;
  cursor:pointer;
}

.messages{
  height:320px;
  overflow-y:auto;
  background:#0f1115;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
}

.message{
  margin-bottom:10px;
  padding:10px;
  background:#1a1d23;
  border-radius:10px;
}

.message.me{
  background:#242932;
}

.message small{
  display:block;
  margin-top:4px;
  font-size:.75rem;
  color:var(--muted);
}
</style>
</head>

<body>

<header>
  <div class="logo">LogiSupport</div>
</header>

<nav>
  <button id="tabAuth" class="active" onclick="showTab('auth')">Вход</button>
  <button id="tabChat" onclick="showTab('chat')">Чат</button>
  <button id="tabProfile" onclick="showTab('profile')">Профиль</button>
</nav>

<section id="auth" class="box">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Пароль">
  <button class="main" onclick="login()">Войти</button>
  <button class="main" onclick="register()">Регистрация</button>
  <button class="main" onclick="guest()">Гость</button>
</section>

<section id="chat" class="box hidden">
  <div class="messages" id="messages"></div>
  <textarea id="content" placeholder="Сообщение"></textarea>
  <button class="main" onclick="sendMessage()">Отправить</button>
</section>

<section id="profile" class="box hidden">
  <input id="pName" placeholder="Имя">
  <input id="pRole" disabled>
  <button class="main" onclick="saveProfile()">Сохранить</button>
</section>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBLbswX9MiSInVqNW12POJ5OmAYKgy2ERw",
  authDomain: "projet-56900.firebaseapp.com",
  databaseURL: "https://projet-56900-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "projet-56900",
  messagingSenderId: "753669702381",
  appId: "1:753669702381:web:0ac180682fba00c68542e4"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;

/* ===== Tabs ===== */
function showTab(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById("tab"+id.charAt(0).toUpperCase()+id.slice(1)).classList.add("active");
}

/* ===== Auth ===== */
function login(){
  auth.signInWithEmailAndPassword(email.value, password.value).catch(alert);
}

function register(){
  auth.createUserWithEmailAndPassword(email.value, password.value).catch(alert);
}

function guest(){
  auth.signInAnonymously().catch(alert);
}

auth.onAuthStateChanged(user=>{
  if(!user) return;
  currentUser = user;

  const ref = db.ref("users/"+user.uid);
  ref.once("value").then(s=>{
    if(!s.exists()){
      ref.set({name:"User", role:"User"});
    }
  });

  ref.on("value", s=>{
    const d = s.val();
    pName.value = d.name;
    pRole.value = d.role;
  });

  showTab("chat");
  loadMessages();
});

/* ===== Chat ===== */
function sendMessage(){
  const text = content.value.trim();
  if(!text) return;

  db.ref("messages").push({
    uid: currentUser.uid,
    name: pName.value,
    text,
    time: new Date().toLocaleString()
  });

  content.value="";
}

function loadMessages(){
  db.ref("messages").on("value", snap=>{
    messages.innerHTML="";
    snap.forEach(c=>{
      const m=c.val();
      const div=document.createElement("div");
      div.className="message"+(m.uid===currentUser.uid?" me":"");
      div.innerHTML=`<b>${m.name}</b><br>${m.text}<small>${m.time}</small>`;
      messages.appendChild(div);
    });
    messages.scrollTop=messages.scrollHeight;
  });
}

/* ===== Profile ===== */
function saveProfile(){
  db.ref("users/"+currentUser.uid+"/name").set(pName.value);
}
</script>

</body>
</html>
